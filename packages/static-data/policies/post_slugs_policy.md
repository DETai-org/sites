# Post Slugs Policy (Localized Blog URL Slugs)

## 1) Цель
Зафиксировать правила для **локализованных slug постов** (route slugs) для каждого сайта,
чтобы улучшить **SEO** и **UX** через человекочитаемые URL на всех 5 языках.

---

## 2) Термины

### 2.1. `postId` (stable id)
Стабильный идентификатор поста.
- используется в данных, связях и внутренних ссылках;
- **не локализуется**;
- **никогда не меняется** после публикации.

### 2.2. `routeSlug` (localized slug)
Локализованный slug поста, который используется **в URL**.
- зависит от языка;
- человекочитаемый;
- оптимизирован под SEO/UX.

### 2.3. `canonical`
Базовая (каноническая) версия URL/slug поста. Используется для SEO-сигналов и
внутренней нормализации адреса.

### 2.4. `redirects`
История перенаправлений. При изменении `routeSlug` требуется фиксировать **301-redirect**
со старого адреса на новый.

---

## 3) Роль Агента Codex и входные данные

### 3.1. Входные данные поста
Каждый пост передаётся Агенту Codex **всегда на русском языке** и сопровождается
структурированными входными данными (frontmatter).

Минимальный и ожидаемый набор входных данных:

```
channels:
title:
authors:
date_ymd:
status:
size:
preview:
seoLead:
rubric_ids:
category_ids:
cycle_id / cycle_title / cycle_intent:
keyword_ids:
keywords_raw:
```

Все последующие решения по созданию slug, размещению файлов и выбору сайтов
принимаются **исключительно** на основании этих входных данных.

---

### 3.2. Поле `channels` как ключевой маршрутизатор
Поле `channels` является **единственным источником истины** для определения,
к какому сайту (или сайтам) относится пост.

Возможные сценарии:
- указан **один сайт** (например: `detai_site_blog` или `personal_site_blog`);
- указаны **оба сайта** — пост размещается на двух сайтах, а локализованные slugs
  создаются и поддерживаются **отдельно для каждого сайта**.

Агент Codex отвечает за полный цикл создания и обновления slugs:
- получает текст поста на одном языке (русском) и frontmatter;
- создаёт локализованные slugs для всех языков;
- размещает данные рядом с постом в соответствующем сайте;
- отслеживает изменения и фиксирует редиректы.

---

## 4) Где хранится
Данные slug добовляються в frontmatter в каждый файл  типа: de.md, cn.md 


Причина: структура маршрутов и организация постов различаются между сайтами,
поэтому slug-и постов не могут жить в общем слое.

⚠️ Общий слой статических данных (`packages/static-data`) **не хранит URL-части**,
которые различаются по сайтам.

---

## 5) Поддерживаемые языки
Список поддерживаемых языков см. в `taxonomy_policy.md` (раздел 3).

Правило: для каждого поста **обязательны** `routeSlug` для **всех поддерживаемых языков**.

---

## 6) Правила

### 6.1. Единые правила формата slug
Общие правила формата slug см. в `route_slugs_policy.md` (раздел 6).

### 6.2. Запрет на изменение `postId`
`postId` является стабильным и **не подлежит изменению**.

### 6.3. Изменение `routeSlug`
Любое изменение `routeSlug` **обязательно** сопровождается 301‑redirect
со старого адреса на новый.

---

## 7) Связь с SEO
Локализованный slug повышает релевантность выдачи в регионе/языке и улучшает
кликабельность. **Canonical** предотвращает дубли и консолидацию SEO-сигналов.

---

## 8) Отличие от таксономии
Таксономия (rubrics/categories/keywords) — **общая** для всех сайтов и хранится
в `packages/static-data`. Посты и их slugs — **локальные** и всегда хранятся
внутри конкретного сайта рядом с текстами постов.

---

## 9) Процесс создания и контроля

1. При создании нового поста должны быть заполнены `routeSlug` **для всех языков**.
2. Если slug меняется — фиксируется `redirect` (301) со старого адреса на новый.
3. До публикации валидируется:
   - полнота переводов;
   - уникальность slugs внутри **конкретного сайта** и **конкретного языка**.
4. Контроль процесса:
   - если есть генератор/скрипт — он должен использоваться;
   - если автоматизации нет — используется ручной контроль.
5. Ручной контроль выполняет Агент Codex, который:
   - получает исходный текст и frontmatter;
   - создаёт/обновляет slugs;
   - проверяет уникальность и полноту переводов;
   - фиксирует редиректы при изменениях.
